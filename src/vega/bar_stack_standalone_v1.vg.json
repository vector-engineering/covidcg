{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "A basic stacked bar chart example.",
  "width": 700,
  "height": 360,
  "padding": 5,

  "data": [
    {
      "name": "cases_by_date_and_group",
      "format": {
        "parse": {
          "group": "string",
          "cases_sum": "number",
          "date": "date:'%Q'"
        }
      },
      "values": [{"group":"B.1","date":1584316800000,"cases_sum":37,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584403200000,"cases_sum":43,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584144000000,"cases_sum":10,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584230400000,"cases_sum":28,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584489600000,"cases_sum":81,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584576000000,"cases_sum":51,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584057600000,"cases_sum":19,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584748800000,"cases_sum":25,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584662400000,"cases_sum":42,"color":"#007a81","group_counts":728},{"group":"B.1","date":1584835200000,"cases_sum":11,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585612800000,"cases_sum":5,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585699200000,"cases_sum":49,"color":"#007a81","group_counts":728},{"group":"B.1","date":1583625600000,"cases_sum":3,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585872000000,"cases_sum":26,"color":"#007a81","group_counts":728},{"group":"B.1","date":1583971200000,"cases_sum":11,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586131200000,"cases_sum":18,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586044800000,"cases_sum":19,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585785600000,"cases_sum":22,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585958400000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586476800000,"cases_sum":9,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585526400000,"cases_sum":62,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586736000000,"cases_sum":9,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586304000000,"cases_sum":18,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586217600000,"cases_sum":5,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586390400000,"cases_sum":6,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586649600000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587513600000,"cases_sum":4,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587340800000,"cases_sum":11,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586822400000,"cases_sum":2,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587427200000,"cases_sum":5,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587686400000,"cases_sum":2,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586908800000,"cases_sum":5,"color":"#007a81","group_counts":728},{"group":"B.1","date":1586995200000,"cases_sum":3,"color":"#007a81","group_counts":728},{"group":"B.1","date":1583712000000,"cases_sum":7,"color":"#007a81","group_counts":728},{"group":"B.1","date":1583798400000,"cases_sum":3,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585440000000,"cases_sum":4,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585008000000,"cases_sum":3,"color":"#007a81","group_counts":728},{"group":"B.1","date":1583884800000,"cases_sum":2,"color":"#007a81","group_counts":728},{"group":"B.1","date":1583280000000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585180800000,"cases_sum":19,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585267200000,"cases_sum":15,"color":"#007a81","group_counts":728},{"group":"B.1","date":1585094400000,"cases_sum":11,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587772800000,"cases_sum":3,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587081600000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1588464000000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1588896000000,"cases_sum":4,"color":"#007a81","group_counts":728},{"group":"B.1","date":1588204800000,"cases_sum":3,"color":"#007a81","group_counts":728},{"group":"B.1","date":1589068800000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1588032000000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1588982400000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587859200000,"cases_sum":2,"color":"#007a81","group_counts":728},{"group":"B.1","date":1587945600000,"cases_sum":1,"color":"#007a81","group_counts":728},{"group":"B.1","date":1588809600000,"cases_sum":2,"color":"#007a81","group_counts":728},{"group":"B.1.3","date":1584403200000,"cases_sum":10,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584489600000,"cases_sum":27,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584576000000,"cases_sum":11,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584144000000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584316800000,"cases_sum":7,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584748800000,"cases_sum":5,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584835200000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584662400000,"cases_sum":8,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585699200000,"cases_sum":15,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585872000000,"cases_sum":5,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584230400000,"cases_sum":4,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585526400000,"cases_sum":10,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586131200000,"cases_sum":4,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586044800000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585958400000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586304000000,"cases_sum":3,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585612800000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586217600000,"cases_sum":2,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586390400000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586476800000,"cases_sum":4,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586736000000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586995200000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1586908800000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1587340800000,"cases_sum":5,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1583366400000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1583712000000,"cases_sum":2,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1583798400000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585440000000,"cases_sum":3,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585785600000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1584057600000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1583971200000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585180800000,"cases_sum":2,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585267200000,"cases_sum":2,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1585094400000,"cases_sum":4,"color":"#038060","group_counts":148},{"group":"B.1.3","date":1587859200000,"cases_sum":1,"color":"#038060","group_counts":148},{"group":"B.2.1","date":1584403200000,"cases_sum":1,"color":"#069471","group_counts":2},{"group":"B.2.1","date":1584489600000,"cases_sum":1,"color":"#069471","group_counts":2},{"group":"A","date":1584489600000,"cases_sum":3,"color":"#821b2a","group_counts":9},{"group":"A","date":1584144000000,"cases_sum":1,"color":"#821b2a","group_counts":9},{"group":"A","date":1584748800000,"cases_sum":1,"color":"#821b2a","group_counts":9},{"group":"A","date":1584057600000,"cases_sum":1,"color":"#821b2a","group_counts":9},{"group":"A","date":1585526400000,"cases_sum":1,"color":"#821b2a","group_counts":9},{"group":"A","date":1583971200000,"cases_sum":1,"color":"#821b2a","group_counts":9},{"group":"A","date":1584576000000,"cases_sum":1,"color":"#821b2a","group_counts":9},{"group":"B.2","date":1584489600000,"cases_sum":6,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584403200000,"cases_sum":6,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584316800000,"cases_sum":5,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584662400000,"cases_sum":4,"color":"#008f96","group_counts":41},{"group":"B.2","date":1585699200000,"cases_sum":2,"color":"#008f96","group_counts":41},{"group":"B.2","date":1585872000000,"cases_sum":3,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584057600000,"cases_sum":2,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584230400000,"cases_sum":1,"color":"#008f96","group_counts":41},{"group":"B.2","date":1586131200000,"cases_sum":1,"color":"#008f96","group_counts":41},{"group":"B.2","date":1585526400000,"cases_sum":1,"color":"#008f96","group_counts":41},{"group":"B.2","date":1583712000000,"cases_sum":5,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584576000000,"cases_sum":3,"color":"#008f96","group_counts":41},{"group":"B.2","date":1584748800000,"cases_sum":1,"color":"#008f96","group_counts":41},{"group":"B.2","date":1585180800000,"cases_sum":1,"color":"#008f96","group_counts":41},{"group":"B.1.26","date":1584489600000,"cases_sum":3,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1584230400000,"cases_sum":1,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1586131200000,"cases_sum":1,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1585526400000,"cases_sum":5,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1586736000000,"cases_sum":1,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1584403200000,"cases_sum":1,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1585785600000,"cases_sum":1,"color":"#08a982","group_counts":15},{"group":"B.1.26","date":1585180800000,"cases_sum":2,"color":"#08a982","group_counts":15},{"group":"B.1.1","date":1584576000000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584489600000,"cases_sum":4,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1583884800000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584144000000,"cases_sum":2,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584662400000,"cases_sum":4,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584835200000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585699200000,"cases_sum":3,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585872000000,"cases_sum":2,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584230400000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584316800000,"cases_sum":2,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1586304000000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1586563200000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1586736000000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1586908800000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585526400000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585612800000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585785600000,"cases_sum":2,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1583971200000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1584057600000,"cases_sum":2,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585440000000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585180800000,"cases_sum":2,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1585094400000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1587686400000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1","date":1587945600000,"cases_sum":1,"color":"#0abe94","group_counts":38},{"group":"B.1.1.9","date":1584489600000,"cases_sum":1,"color":"#1b8018","group_counts":2},{"group":"B.1.1.9","date":1584576000000,"cases_sum":1,"color":"#1b8018","group_counts":2},{"group":"A.1","date":1584403200000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1584489600000,"cases_sum":3,"color":"#f45455","group_counts":15},{"group":"A.1","date":1583971200000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1584057600000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1584144000000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1583280000000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1583712000000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1585526400000,"cases_sum":2,"color":"#f45455","group_counts":15},{"group":"A.1","date":1583884800000,"cases_sum":2,"color":"#f45455","group_counts":15},{"group":"A.1","date":1584576000000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.1","date":1584662400000,"cases_sum":1,"color":"#f45455","group_counts":15},{"group":"A.5","date":1584489600000,"cases_sum":1,"color":"#e9494c","group_counts":1},{"group":"B.1.p2","date":1584489600000,"cases_sum":1,"color":"#0ad3a7","group_counts":2},{"group":"B.1.p2","date":1585699200000,"cases_sum":1,"color":"#0ad3a7","group_counts":2},{"group":"A.2","date":1584662400000,"cases_sum":1,"color":"#de3e42","group_counts":1},{"group":"B.1.29","date":1584748800000,"cases_sum":1,"color":"#07e9ba","group_counts":5},{"group":"B.1.29","date":1584230400000,"cases_sum":2,"color":"#07e9ba","group_counts":5},{"group":"B.1.29","date":1586131200000,"cases_sum":1,"color":"#07e9ba","group_counts":5},{"group":"B.1.29","date":1586304000000,"cases_sum":1,"color":"#07e9ba","group_counts":5},{"group":"B.1.1.1","date":1585699200000,"cases_sum":1,"color":"#2a9424","group_counts":1},{"group":"A.3","date":1584316800000,"cases_sum":1,"color":"#d4333a","group_counts":4},{"group":"A.3","date":1585526400000,"cases_sum":1,"color":"#d4333a","group_counts":4},{"group":"A.3","date":1584576000000,"cases_sum":1,"color":"#d4333a","group_counts":4},{"group":"A.3","date":1588204800000,"cases_sum":1,"color":"#d4333a","group_counts":4},{"group":"B","date":1585526400000,"cases_sum":2,"color":"#006386","group_counts":6},{"group":"B","date":1583107200000,"cases_sum":1,"color":"#006386","group_counts":6},{"group":"B","date":1583712000000,"cases_sum":2,"color":"#006386","group_counts":6},{"group":"B","date":1584403200000,"cases_sum":1,"color":"#006386","group_counts":6},{"group":"B.1.5","date":1585872000000,"cases_sum":1,"color":"#00ffce","group_counts":4},{"group":"B.1.5","date":1583971200000,"cases_sum":1,"color":"#00ffce","group_counts":4},{"group":"B.1.5","date":1585267200000,"cases_sum":1,"color":"#00ffce","group_counts":4},{"group":"B.1.5","date":1584489600000,"cases_sum":1,"color":"#00ffce","group_counts":4},{"group":"B.1.41","date":1586131200000,"cases_sum":1,"color":"#006d51","group_counts":1}],
      "transform": [
        {
          "type": "bin",
          "field": "date",
          "extent": [{"signal": "dateRangeStart"}, {"signal": "dateRangeEnd"}],
          "step": {"signal": "dateBin"},
          "as": ["day_start", "day_end"]
        },
        {
          "type": "aggregate",
          "groupby": ["group", "day_start", "day_end"],
          "fields": ["cases_sum", "group_counts", "color"],
          "ops": ["sum", "max", "max"],
          "as": ["cases_sum", "group_counts", "color"]
        },
        {
          "type": "window",
          "sort": {"field": "day_start"},
          "groupby": ["group"],
          "ops": ["sum"],
          "fields": ["cases_sum"],
          "as": [{"signal": "windowField"}],
          "frame": [null, 0]
        },
        {
          "type": "stack",
          "groupby": ["day_start"],
          "sort": {"field": "group"},
          "field": "cases_sum",
          "offset": {"signal": "stackOffset"}
        }
      ]
    },
    {
      "name": "cases_by_date",
      "source": "cases_by_date_and_group",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["day_start", "day_end"],
          "fields": ["cases_sum"],
          "ops": ["sum"],
          "as": ["cases_sum_by_date"]
        }
      ]
    },
    {
      "name": "selected",
      "on": [
        {"trigger": "clear", "remove": true},
        {"trigger": "!shift", "remove": true},
        {"trigger": "!shift && clicked", "insert": "clicked"},
        {"trigger": "shift && clicked", "toggle": "clicked"}
      ]
    }
  ],

  "signals": [
    {"name": "dateRangeStart", "value": 1575158400000},
    {"name": "dateRangeEnd", "value": 1609372800000},
    {"name": "dateBin", "value": 604800000},
    {"name": "overviewYLabel", "value": "All Seqs"},
    {"name": "detailYLabel", "value": "Sequences by Lineage"},
    {"name": "stackOffset", "value": "zero"},
    {"name": "windowField", "value": "cases_sum"},
    {"name": "detailDomain"},
    {"name": "brush", "value": 0},
    {"name": "delta", "value": 0},
    {"name": "xdown", "value": 0},
    {"name": "anchor", "value": null},
    {"name": "hoverBar", "value": null},
    {
      "name": "clear", "value": true,
      "on": [
        {
          "events": "mouseup[!event.item]",
          "update": "true",
          "force": true
        }
      ]
    },
    {
      "name": "shift", "value": false,
      "on": [
        {
          "events": "@detailbars:click",
          "update": "event.shiftKey",
          "force":  true
        }
      ]
    },
    {
      "name": "clicked", "value": null,
      "on": [
        {
          "events": "@detailbars:click",
          "update": "{group: datum.group}",
          "force":  true
        }
      ]
    }
  ],

  "marks": [
    {
      "type": "group",
      "name": "detail",
      "encode": {
        "enter": {
          "height": {"value": 280},
          "width": {"value": 700}
        }
      },
      "signals": [
        {
          "name": "hoverBar",
          "push": "outer",
          "on": [
            {
              "events": "@detailbars:mouseover!",
              "update": "{group: datum.group, date: datum.day_start}"
            },
            {
              "events": "@detailbars:mouseout!",
              "update": "null"
            }
          ]
        }
      ],
      "scales": [
        {
          "name": "x",
          "type": "time",
          "range": "width",
          "domain": {
            "fields": [
              {"data": "cases_by_date", "field": "day_start"},
              {"data": "cases_by_date", "field": "day_end"}
            ]
          },
          "domainRaw": {"signal": "detailDomain"}
        },
        {
          "name": "y",
          "type": "linear",
          "range": [280, 0],
          "nice": true, "zero": true,
          "domain": {"data": "cases_by_date_and_group", "field": "y1"}
        }
      ],
      "axes": [
        {
          "orient": "bottom", 
          "scale": "x", 
          "zindex": 0, 
          "format": "%m-%d", 
          "tickCount": "week",
          "grid": true,
          "gridScale": "y",
          "gridColor": "#DDD",

          "labelFontSize": 12,
          "labelPadding": 3
        },
        {
          "orient": "left", 
          "scale": "y", 
          "zindex": 0,
          "grid": true,
          "gridColor": "#DDD",

          "title": {"signal": "detailYLabel"},
          "titleFontSize": 14,
          "titlePadding": 10,
          
          "labelFontSize": 14,
          "labelPadding": 5,
          "tickCount": 5
        }
      ],
      "marks": [
        {
          "type": "group",
          "encode": {
            "enter": {
              "height": {"field": {"group": "height"}},
              "width": {"field": {"group": "width"}},
              "clip": {"value": true}
            }
          },
          "marks": [
            {
              "type": "rect",
              "name": "detailbars",
              "from": {"data": "cases_by_date_and_group"},
              "encode": {
                "enter": {
                  "strokeWidth": {"value": 1},
                  "tooltip": {
                    "signal": "{title: datum.group, 'Total sequences': datum.group_counts, 'Sequences': datum.cases_sum, 'Collection date': timeFormat(datum.day_start, '%b %d %Y')}"
                  }
                },
                "update": {
                  "x": {"scale": "x", "field": "day_start"},
                  "x2": {"scale": "x", "field": "day_end"},
                  "y": {"scale": "y", "field": "y0"},
                  "y2": {"scale": "y", "field": "y1"},
                  "fill": [
                    {
                      "test": "(!length(data('selected')) || indata('selected', 'group', datum.group))",
                      "field": "color"
                    },
                    {"value": "#CCC"}
                  ],
                  "stroke": [
                    {
                      "test": "hoverBar && hoverBar.group == datum.group",
                      "value": "#000"
                    }, 
                    {"value": "transparent"}
                  ],
                  "zindex": [
                    {
                      "test": "hoverBar && hoverBar.group == datum.group",
                      "value": 3
                    }, 
                    {"value": 1}
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "group",
      "name": "overview",
      "encode": {
        "enter": {
          "x": {"value": 0},
          "y": {"value": 300},
          "width": {"value": 700},
          "height": {"value": 60},
          "fill": {"value": "transparent"}
        }
      },
      "signals": [
        {
          "name": "brush",
          "push": "outer",
          "on": [
            {
              "events": {
                "merge": [
                  {"markname": "overview", "type": "mousedown" },
                  {"markname": "overviewbars", "type": "mousedown" }
                ]
              },
              "update": "[x(), x()]"
            },
            {
              "events": {
                "merge": [
                  {"markname": "overview", "type": "dblclick"},
                  {"markname": "brushrect", "type": "dblclick"}                    
                ]
              },
              "update": "0"
            },
            {
              "events": {
                "merge": [
                  {
                    "source": "window",
                    "type": "mousemove",
                    "between": [
                      {"markname": "overview", "type": "mousedown"},
                      {"source": "window", "type": "mouseup"}
                    ],
                    "consume": true
                  },
                  {
                    "source": "window",
                    "type": "mousemove",
                    "between": [
                      {"markname": "overviewbars", "type": "mousedown"},
                      {"source": "window", "type": "mouseup"}
                    ],
                    "consume": true
                  }
                ]
              },
              "update": "[brush[0], clamp(x(), 0, width)]"
            },
            {
              "events": {
                "merge": [
                  {"markname": "overview", "type": "mouseup"},
                  {"markname": "brushrect", "type": "mouseup"}              
                ]
              },
              "update": "abs(span(brush)) <= 2 ? 0 : [brush[0], brush[1]]"
            },
            {
              "events": {"signal": "delta"},
              "update": "clampRange([anchor[0] + delta, anchor[1] + delta], 0, width)"
            }
          ]
        },
        {
          "name": "anchor",
          "push": "outer",
          "on": [{"events": "@brushrect:mousedown", "update": "slice(brush)"}]
        },
        {
          "name": "xdown",
          "push": "outer",
          "on": [{"events": "@brushrect:mousedown", "update": "x()"}]
        },
        {
          "name": "delta",
          "push": "outer",
          "on": [
            {
              "events": "[@brushrect:mousedown, window:mouseup] > window:mousemove!",
              "update": "x() - xdown"
            }
          ]
        },
        {
          "name": "detailDomain",
          "push": "outer",
          "on": [
            {
              "events": {"signal": "brush"},
              "update": "span(brush) ? invert('xOverview', brush) : null"
            }
          ]
        }
      ],
      "scales": [
        {
          "name": "xOverview",
          "type": "time",
          "range": "width",
          "domain": {
            "fields": [
              {"data": "cases_by_date", "field": "day_start"},
              {"data": "cases_by_date", "field": "day_end"}
            ]
          }
        },
        {
          "name": "yOverview",
          "type": "linear",
          "range": [60, 0],
          "domain": {"data": "cases_by_date", "field": "cases_sum_by_date"},
          "nice": true, "zero": true
        }
      ],
      "axes": [
        {
          "orient": "bottom", 
          "scale": "xOverview",  
          "title": "Collection date", 
          "titleFontSize": 18,
          "titlePadding": 10,
          "format": "%m-%d", 

          "grid": true,
          "gridColor": "#DDD",
          "gridScale": "yOverview",

          "labelFontSize": 12,
          "labelPadding": 3,

          "tickCount": "week"
          
        },
        {
          "orient": "left", 
          "scale": "yOverview",

          "title": {"signal": "overviewYLabel"},
          "titleFontSize": 14,
          "titlePadding": 10,

          "labelFontSize": 14,
          "labelPadding": 3,

          "tickCount": 3
        }
      ],
      "marks": [
        {
          "type": "rect",
          "name": "overviewbars",
          "from": {"data": "cases_by_date"},
          "encode": {
            "enter": {
              "x": {"scale": "xOverview", "field": "day_start"},
              "x2": {"scale": "xOverview", "field": "day_end"},
              "y": {"scale": "yOverview", "value": 0},
              "y2": {"scale": "yOverview", "field": "cases_sum_by_date"}
            },
            "update": {
              "fill": [
                {
                  "test": "detailDomain && inrange(datum.day_start, detailDomain)",
                  "value": "#f00"
                },
                {"value": "#888"}
              ]
            }
          }
        },
        {
          "type": "rect",
          "name": "brushrect",
          "encode": {
            "enter": {
              "y": {"value": 0},
              "height": {"value": 60},
              "fill": {"value": "#333"},
              "fillOpacity": {"value": 0.2}
            },
            "update": {
              "x": {"signal": "brush[0]"},
              "x2": {"signal": "brush[1]"}
            }
          }
        },
        {
          "type": "rect",
          "interactive": false,
          "encode": {
            "enter": {
              "y": {"value": 0},
              "height": {"value": 60},
              "width": {"value": 1},
              "fill": {"value": "firebrick"}
            },
            "update": {
              "x": {"signal": "brush[0]"}
            }
          }
        },
        {
          "type": "rect",
          "interactive": false,
          "encode": {
            "enter": {
              "y": {"value": 0},
              "height": {"value": 60},
              "width": {"value": 1},
              "fill": {"value": "firebrick"}
            },
            "update": {
              "x": {"signal": "brush[1]"}
            }
          }
        }
      ]
    }
  ]
}
